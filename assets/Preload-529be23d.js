import{am as re,an as ne,ao as oe,ap as se,aq as ce,ar as ie,as as ue,at as le,au as ae,av as fe,u as D,aw as de,ax as ve}from"./index-43782085.esm-153d635e.js";import{r as o}from"./index-8beb32d0.js";function P(){return P=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(r[t]=n[t])}return r},P.apply(this,arguments)}function I(r,e,n){var t,c,s,u,l;e==null&&(e=100);function i(){var d=Date.now()-u;d<e&&d>=0?t=setTimeout(i,e-d):(t=null,n||(l=r.apply(s,c),s=c=null))}var a=function(){s=this,c=arguments,u=Date.now();var d=n&&!t;return t||(t=setTimeout(i,e)),d&&(l=r.apply(s,c),s=c=null),l};return a.clear=function(){t&&(clearTimeout(t),t=null)},a.flush=function(){t&&(l=r.apply(s,c),s=c=null,clearTimeout(t),t=null)},a}I.debounce=I;var Y=I;function pe(r){let{debounce:e,scroll:n,polyfill:t,offsetSize:c}=r===void 0?{debounce:0,scroll:!1,offsetSize:!1}:r;const s=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[u,l]=o.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),i=o.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:u}),a=e?typeof e=="number"?e:e.scroll:null,d=e?typeof e=="number"?e:e.resize:null,b=o.useRef(!1);o.useEffect(()=>(b.current=!0,()=>void(b.current=!1)));const[z,_,p]=o.useMemo(()=>{const f=()=>{if(!i.current.element)return;const{left:L,top:y,width:S,height:M,bottom:T,right:B,x:w,y:C}=i.current.element.getBoundingClientRect(),v={left:L,top:y,width:S,height:M,bottom:T,right:B,x:w,y:C};i.current.element instanceof HTMLElement&&c&&(v.height=i.current.element.offsetHeight,v.width=i.current.element.offsetWidth),Object.freeze(v),b.current&&!Ee(i.current.lastBounds,v)&&l(i.current.lastBounds=v)};return[f,d?Y(f,d):f,a?Y(f,a):f]},[l,c,a,d]);function E(){i.current.scrollContainers&&(i.current.scrollContainers.forEach(f=>f.removeEventListener("scroll",p,!0)),i.current.scrollContainers=null),i.current.resizeObserver&&(i.current.resizeObserver.disconnect(),i.current.resizeObserver=null)}function O(){i.current.element&&(i.current.resizeObserver=new s(p),i.current.resizeObserver.observe(i.current.element),n&&i.current.scrollContainers&&i.current.scrollContainers.forEach(f=>f.addEventListener("scroll",p,{capture:!0,passive:!0})))}const x=f=>{!f||f===i.current.element||(E(),i.current.element=f,i.current.scrollContainers=q(f),O())};return he(p,Boolean(n)),me(_),o.useEffect(()=>{E(),O()},[n,p,_]),o.useEffect(()=>E,[]),[x,u,z]}function me(r){o.useEffect(()=>{const e=r;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[r])}function he(r,e){o.useEffect(()=>{if(e){const n=r;return window.addEventListener("scroll",n,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",n,!0)}},[r,e])}function q(r){const e=[];if(!r||r===document.body)return e;const{overflow:n,overflowX:t,overflowY:c}=window.getComputedStyle(r);return[n,t,c].some(s=>s==="auto"||s==="scroll")&&e.push(r),[...e,...q(r.parentElement)]}const be=["x","y","top","bottom","left","right","width","height"],Ee=(r,e)=>be.every(n=>r[n]===e[n]);var we=Object.defineProperty,Ce=Object.defineProperties,ge=Object.getOwnPropertyDescriptors,A=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable,U=(r,e,n)=>e in r?we(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n,X=(r,e)=>{for(var n in e||(e={}))_e.call(e,n)&&U(r,n,e[n]);if(A)for(var n of A(e))Oe.call(e,n)&&U(r,n,e[n]);return r},ye=(r,e)=>Ce(r,ge(e));function V(r,e,n){if(!r)return;if(n(r)===!0)return r;let t=e?r.return:r.child;for(;t;){const c=V(t,e,n);if(c)return c;t=e?null:t.sibling}}function G(r){try{return Object.defineProperties(r,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return r}}const F=G(o.createContext(null));class $ extends o.Component{render(){return o.createElement(F.Provider,{value:this._reactInternals},this.props.children)}}const{ReactCurrentOwner:Re,ReactCurrentDispatcher:Pe}=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function ze(){const r=o.useContext(F);if(!r)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=o.useId();return o.useMemo(()=>{var t;return(t=Re.current)!=null?t:V(r,!1,c=>{let s=c.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}})},[r,e])}function xe(){var r,e;const n=ze(),[t]=o.useState(()=>new Map);t.clear();let c=n;for(;c;){const s=(r=c.type)==null?void 0:r._context;s&&s!==F&&!t.has(s)&&t.set(s,(e=Pe.current)==null?void 0:e.readContext(G(s))),c=c.return}return o.useMemo(()=>Array.from(t.keys()).reduce((s,u)=>l=>o.createElement(s,null,o.createElement(u.Provider,ye(X({},l),{value:t.get(u)}))),s=>o.createElement($,X({},s))),[t])}const j={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Le(r){const{handlePointer:e}=fe(r);return{priority:1,enabled:!0,compute(n,t,c){t.pointer.set(n.offsetX/t.size.width*2-1,-(n.offsetY/t.size.height)*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(j).reduce((n,t)=>({...n,[t]:e(t)}),{}),update:()=>{var n;const{events:t,internal:c}=r.getState();(n=c.lastEvent)!=null&&n.current&&t.handlers&&t.handlers.onPointerMove(c.lastEvent.current)},connect:n=>{var t;const{set:c,events:s}=r.getState();s.disconnect==null||s.disconnect(),c(u=>({events:{...u.events,connected:n}})),Object.entries((t=s.handlers)!=null?t:[]).forEach(([u,l])=>{const[i,a]=j[u];n.addEventListener(i,l,{passive:a})})},disconnect:()=>{const{set:n,events:t}=r.getState();if(t.connected){var c;Object.entries((c=t.handlers)!=null?c:[]).forEach(([s,u])=>{if(t&&t.connected instanceof HTMLElement){const[l]=j[s];t.connected.removeEventListener(l,u)}}),n(s=>({events:{...s.events,connected:void 0}}))}}}}const Se=o.forwardRef(function({children:e,fallback:n,resize:t,style:c,gl:s,events:u=Le,eventSource:l,eventPrefix:i,shadows:a,linear:d,flat:b,legacy:z,orthographic:_,frameloop:p,dpr:E,performance:O,raycaster:x,camera:f,onPointerMissed:L,onCreated:y,...S},M){o.useMemo(()=>re(ae),[]);const T=xe(),[B,w]=pe({scroll:!0,debounce:{scroll:50,resize:0},...t}),C=o.useRef(null),v=o.useRef(null),[g,J]=o.useState(null);o.useImperativeHandle(M,()=>C.current);const N=ne(L),[k,K]=o.useState(!1),[W,Q]=o.useState(!1);if(k)throw k;if(W)throw W;const R=o.useRef(null);w.width>0&&w.height>0&&g&&(R.current||(R.current=oe(g)),R.current.configure({gl:s,events:u,shadows:a,linear:d,flat:b,legacy:z,orthographic:_,frameloop:p,dpr:E,performance:O,raycaster:x,camera:f,size:w,onPointerMissed:(...m)=>N.current==null?void 0:N.current(...m),onCreated:m=>{m.events.connect==null||m.events.connect(l?se(l)?l.current:l:v.current),i&&m.setEvents({compute:(H,h)=>{const ee=H[i+"X"],te=H[i+"Y"];h.pointer.set(ee/h.size.width*2-1,-(te/h.size.height)*2+1),h.raycaster.setFromCamera(h.pointer,h.camera)}}),y==null||y(m)}}),R.current.render(o.createElement(T,null,o.createElement(ce,{set:Q},o.createElement(o.Suspense,{fallback:o.createElement(ie,{set:K})},e))))),ue(()=>{J(C.current)},[]),o.useEffect(()=>{if(g)return()=>le(g)},[g]);const Z=l?"none":"auto";return o.createElement("div",P({ref:v,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Z,...c}},S),o.createElement("div",{ref:B,style:{width:"100%",height:"100%"}},o.createElement("canvas",{ref:C,style:{display:"block"}},n)))}),De=o.forwardRef(function(e,n){return o.createElement($,null,o.createElement(Se,P({},e,{ref:n})))});function je({all:r,scene:e,camera:n}){const t=D(({gl:u})=>u),c=D(({camera:u})=>u),s=D(({scene:u})=>u);return o.useLayoutEffect(()=>{const u=[];r&&(e||s).traverse(a=>{a.visible===!1&&(u.push(a),a.visible=!0)}),t.compile(e||s,n||c);const l=new de(128);new ve(.01,1e5,l).update(t,e||s),l.dispose(),u.forEach(a=>a.visible=!1)},[]),null}export{De as C,je as P,P as _};
